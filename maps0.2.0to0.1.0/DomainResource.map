map "http://chmed16af.emediplan.ch/fhir/StructureMap/DomainResource0.2.0to0.1.0" = "Conversion for DomainResource"

uses "http://hl7.org/fhir/StructureDefinition/DomainResource" as source
uses "http://hl7.org/fhir/StructureDefinition/DomainResource" as target

imports "http://chmed16af.emediplan.ch/fhir/StructureMap/*0.2.0to0.1.0"

group DomainResource(source src : DomainResource, target tgt : DomainResource) extends Resource {
  src.text as v -> tgt.text = v;
  src.contained as v -> tgt.contained = v;
  src.extension as v where (url.startsWith('http://chmed16af.emediplan.ch/fhir/StructureDefinition/') and url.startsWith('http://chmed16af.emediplan.ch/fhir/StructureDefinition/chmed16af-receiver').not()) -> tgt.extension = create('Extension') as e then extensionPrivateField(v, e) "SettingPrivatefields";
  src.extension as v where (url.startsWith('http://chmed16af.emediplan.ch/fhir/StructureDefinition/') and url.startsWith('http://chmed16af.emediplan.ch/fhir/StructureDefinition/chmed16af-receiver').not()).not() -> tgt.extension = v;
  src.modifierExtension as v -> tgt.modifierExtension = v;
}

group extensionPrivateField(source src : Extension, target tgt : Extension) {
  src.extension as v where (url.startsWith('name')) -> tgt as e then extensionPrivateFieldName(v, e) "SettingPrivateFieldName";
  src.extension as v where (url.startsWith('value')) -> tgt as e then extensionPrivateFieldValue(v, e) "SettingPrivateFieldValue";
}

group extensionPrivateFieldName(source src : uri, target tgt : Extension) {
  src.value as v -> tgt.url = append('http://chmed16af.emediplan.ch/fhir/StructureDefinition/',v) "PrivateFieldName";
}
 
group extensionPrivateFieldValue(source src : string, target tgt : Extension) {
  src.value as v -> tgt.value = v;
}